<!--
@license
@author Javier Caballero Abenza. All rights reserved.

An element to search and watch videos from YouTube

Example:

    <youtube-wc></youtube-wc>

@element youtube-wc
@demo demo/index.html
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/av-icons.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-header-panel/paper-header-panel.html">

<dom-module id="youtube-wc">

  <template>
    <style is="custom-style">

      :host {
        display: block;
        min-width: 450px;
        min-height: 300px;        
        width: 450px;
        height: 300px;
        max-width: 600px;
        max-height: 400px;  
        background: var(--paper-grey-300);
        overflow: hidden;
        position: relative;
        
      }

      .header{
        min-height: 60px;
        max-height: 60px;
        background: #ffffff;
        color: var(--paper-grey-500);
      }

      .icon{
        padding: 5px;
        --iron-icon-width: 70px;
        --iron-icon-height: 30px;
      }

      .header paper-icon-button:hover{
        color: var(--paper-grey-900);
      }

      .header ::shadow #topBar {
        padding-left: 0;
      }

      .header .menu{
        margin-left: 5px;
        margin-right: 0;
        padding-left: 0;
        padding-right: 0;
      }

      .header .search-box{
        margin-left: auto;
        margin-right: auto;
      }

      .dropdown-content{
        background: #ffffff;
        width: 100px;
        max-width: 100px;
        color: var(--paper-grey-800);
        padding: 0;

        position: absolute;
        z-index: 1;
        left: -105px;
        top: 60px;
        transition: .5s ease;
      }

      .dropdown-content .item{
        width: 100%;
        margin: 0;
        text-transform: none;
      }

      .content{

      }
  
    </style>
    <!--
    <input is="iron-input" bind-value="{{_keywords}}">
    <paper-button raised on-click="search">SEARCH</paper-button>
    -->
    <!-- HEADER -->
    <paper-header-panel mode="seamed">
      <paper-toolbar class="header">
        <paper-icon-button icon="menu" class="menu" on-click="toggle"></paper-icon-button>
        <iron-icon src="resources/youtube.png" class="icon"></iron-icon>
        <div class="search-box">
          <input is="iron-input" bind-value="{{_keywords}}">
          <paper-icon-button icon="search" on-click="search"></paper-icon-button>
        </div>
      </paper-toolbar>
    </paper-header-panel>
    <paper-menu id="dropdown-content" class="dropdown-content" role="listbox">
      <paper-button raised class="item">Opcion 1</paper-button>
      <paper-button raised class="item">Opcion 2</paper-button>
      <paper-button raised class="item">Opcion 3</paper-button>
    </paper-menu>
    <!-- MAIN CONTENT -->
    <div class="content">
    </div>
    <div class="footer">
      <paper-icon-button icon="refresh" on-click="refresh"></paper-icon-button>
      <paper-icon-button icon="icons:arrow-back" on-click="before"></paper-icon-button>
      <span>{{cursor}}</span>
      <paper-icon-button icon="icons:arrow-forward"></paper-icon-button>
    </div>








    <!-- AJAX CALLS -->

    <iron-ajax
      id="language_request"
      url="{{component_base}}language/{{_lan_file}}"
      on-response="_language_response"
      >
    </iron-ajax>

    <iron-ajax
       id="refresh_token" 
       url="https://accounts.google.com/o/oauth2/token" 
       method="POST"
       params="{{_token_params}}" 
       on-response="_token_received"
       >
    </iron-ajax>

    <iron-ajax
       id="search_request" 
       url="{{_base_URL}}/search?{{_search_params}}" 
       on-response="_search_response"
       >
    </iron-ajax>
    
  </template>

  <script>

    Polymer({

      is: 'youtube-wc',

      properties: {

      //PUBLIC CONFIG PARAMS

        /* Token: The access_token generated to grant access to the API */
        token: {
          type: String,
          reflectToAttribute: true
        },

        /* Refresh Token: The refresh token generated to update the access_token */
        refresh_token: String,

        /* API Key: The API Key for your application */
        api_key: String,

        /* Client Id: The OAuth 2.0 client ID for your application */
        client_id: String,

        /* Client Secret: The OAuth 2.0 client SECRET for your application */
        client_secret: String,

        /* Component Base: The component base directory */
        component_base: {
          type: String,
          value:""
        },

        /* Language: Language for your application */
        language: {
          type: String,
          value: "en",
          observer: "_languageChanged"
        },

      //INTERNAL CONFIG PARAMS

        /* Language */

        _lan_file: String,

        /* Token refresh */

        _token_params:{
          type: String,
          computed: "_get_token_params(client_id, client_secret, refresh_token)"
        },

        /* API methods */

        _base_URL:{
          type: String,
          value: "https://www.googleapis.com/youtube/v3"
        },

        _search_params: String,

        _maxResults: {
          type: Number,
          value: 10
        },

      },

      // LANGUAGE SUPPORT

      _languageChanged: function(newVal, oldValue) {
        switch(newVal){
          case "es":
            this.language = "es";
            this._lan_file = "es_es.json"
            break;
          default:
            this.language = "en";
            this._lan_file = "en_en.json"
        }
        if (this.component_base || this.component_base == "") {
          this.$.language_request.generateRequest();
        }
      },

      _language_response: function(event, detail){
        this.words = detail.response;
      },

      // TOKEN REFRESH

      _get_token_params: function(client_id, client_secret, refresh_token){
        return {
            client_id: client_id, 
            client_secret: client_secret, 
            refresh_token: refresh_token, 
            grant_type: "refresh_token"
          };
      },

      _token_received: function(event, detail){
        this.token = detail.response.access_token;
      },

      // API METHODS

      _search_response: function(event, detail){
        console.log(detail.response);
      },

      // PUBLIC METHODS

      search: function(){
        this._search_params=
        'part=snippet&'+
        'key=' + this.api_key + '&' +
        'q=' + this._keywords + '&' +
        'maxResults=' + this._maxResults;
        

        this.$.search_request.generateRequest();
      },

      // Element Lifecycle

      ready: function() {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
      },

      attached: function() {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
        this.$['dropdown-content'].style.left="-105px";
      },

      detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },

      // Element Behavior

      toggle: function(){
        if(this.$['dropdown-content'].style.left=="-105px"){
          this.$['dropdown-content'].style.left="0";
        }
        else{
          this.$['dropdown-content'].style.left="-105px";
        }
      },

    });


  </script>

</dom-module>